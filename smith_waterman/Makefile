#  Copyright (c) 2010, Jim Sukha
#  All rights reserved.
#
#  Redistribution and use in source and binary forms, with or without
#  modification, are permitted provided that the following conditions are met:
#     * Redistributions of source code must retain the above copyright
#       notice, this list of conditions and the following disclaimer.
#     * Redistributions in binary form must reproduce the above copyright
#       notice, this list of conditions and the following disclaimer in the
#       documentation and/or other materials provided with the distribution.
#     * Neither the name of the authors nor the names of its
#       contributors may be used to endorse or promote products
#       derived from this software without specific prior written
#       permission.
#
#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
#  "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
#  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
#  A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
#  HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
#  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
#  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS
#  OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
#  AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
#  LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
#  WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
#  POSSIBILITY OF SUCH DAMAGE.
#  

NABBIT_ROOT=..

include ${NABBIT_ROOT}/mk/Makefile

MAIN_TARGET=sw_compute

BLOCK_TARGETS=swblock_1 swblock_2 swblock_4 swblock_8 swblock_16	\
swblock_32 swblock_64 swblock_128

BLOCKCONS_TARGETS=swblockCons_1 swblockCons_2 swblockCons_4	\
swblockCons_8 swblockCons_16 swblockCons_32 swblockCons_64	\
swblockCons_128

ALL_TARGETS = $(MAIN_TARGET) $(BLOCK_TARGETS) $(BLOCKCONS_TARGETS)

MAIN_SRC = $(addsuffix .cpp,$(MAIN_TARGET))
H_FILES = SWDagNode.h SWDagParams.h matrix_utils.h sw_computeEF.h	\
sw_matrix_kernels.h sw_test_types.h

# Output files generated when we are collecting statistics.  Some are
# generated by Cilkview, others are generated if we choose to generate
# an output image.
STAT_OUTPUTS = *.ppm *.csv *.plt *.out


default: $(MAIN_TARGET) $(BLOCK_TARGETS)

all: $(ALL_TARGETS)

# Build the main file.
$(MAIN_TARGET): $(MAIN_SRC) $(H_FILES) $(O_FILES)
	$(CXX) $(CXXFLAGS) $(MAIN_SRC) $(NABBIT_INCLUDES) $(O_FILES) $(LIBARG) -o $@

# Build variants of block size. 
swblock_%: $(MAIN_SRC) $(H_FILES) $(O_FILES)
	$(CXX) $(CXXFLAGS) $(MAIN_SRC) -DBLOCK_VALUE=$* $(NABBIT_INCLUDES) $(O_FILES) $(LIBARG) -o $@

## Set the block size as a compile time flag, and also have constant 
## computation for E and F.
swblockCons_%: $(MAIN_SRC) $(H_FILES) $(O_FILES)
	$(CXX) $(CXXFLAGS) $(MAIN_SRC) -DBLOCK_VALUE=$* -DCOMPUTE_CONSTANT_EF $(NABBIT_INCLUDES) $(O_FILES) $(LIBARG) -o $@

clean:
	rm -rf $(ALL_TARGETS) *.o  $(STAT_OUTPUTS) $(MOVIE_OUTPUTS)  *.obj *.exe
